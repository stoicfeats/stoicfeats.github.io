{{ define "main" }}
{{ partial "back_link.html" .}}

<h1>{{ .Title | lower }}</h1>

{{ .Content }}

{{/* Define the order of levels */}}
{{ $levels := slice "beginner" "intermediate" "advanced" }}

{{/* Range through defined levels */}}
{{ range $levels }}
  {{ $level := . }}
  {{/* Use .Pages to get pages in the current section */}}
  {{ $projects := where $.Pages "Params.level" $level }}
  
  {{ if gt (len $projects) 0 }}
    <h3>{{ $level }}</h3>
    <ul>
      {{ range $projects }}
        <li>
          <a href="{{ .RelPermalink }}">{{ .Title | lower }}</a>
          {{ if .Params.project_url }}
          <a href="{{ .Params.project_url }}" target="_blank" style="float: right; font-size: 0.8em; font-weight: normal; text-decoration: none; display: inline-flex; align-items: center;">
            live
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 4px;"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
          </a>
          {{ end }}
        </li>
      {{ end }}
    </ul>
  {{ end }}
{{ end }}

{{/* Handle projects with other levels or no level */}}
{{ $otherProjects := slice }}
{{ range .Pages }}
  {{/* Check if level is not set OR level is not in the defined list */}}
  {{ if or (not .Params.level) (not (in $levels .Params.level)) }}
    {{ $otherProjects = $otherProjects | append . }}
  {{ end }}
{{ end }}

{{ if gt (len $otherProjects) 0 }}
  <h3>others</h3>
  <ul>
    {{ range $otherProjects }}
      <li>
        <a href="{{ .RelPermalink }}">{{ .Title | lower }}</a>
        {{ if .Params.project_url }}
        <a href="{{ .Params.project_url }}" target="_blank" style="float: right; font-size: 0.8em; font-weight: normal; text-decoration: none; display: inline-flex; align-items: center;">
          live
          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 4px;"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
        </a>
        {{ end }}
      </li>
    {{ end }}
  </ul>
{{ end }}

{{ end }}
